name: PHP Composer

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  php-stan:
    runs-on: ubuntu-latest
    steps:
    - name: Install prestashop                              
      run: |
        wget https://download.prestashop.com/download/releases/prestashop_1.7.7.0.zip
        unzip prestashop_1.7.7.0.zip
        unzip prestashop.zip -d prestashop
        rm prestashop.zip prestashop_1.7.7.0.zip
    - run: mkdir prestashop/modules/plugin-prestashop
    - uses: actions/checkout@v2 
      with:
         path: prestashop/modules/plugin-prestashop
    - name: Install composer and run PhpStan
      run: |
        pwd
        ls -al
        composer install
        _PS_ROOT_DIR_=./ php vendor/phpstan/phpstan/phpstan.phar --configuration=phpstan.neon analyse ./
        working-directory: prestashop/modules/plugin-prestashop

    - name: run PhpCSFixer
      run: php vendor/bin/php-cs-fixer fix --dry-run --diff
